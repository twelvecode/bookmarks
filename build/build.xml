<?xml version="1.0" encoding="utf-8"?>
<project name="Bookmarks" default="development">

    <property name="modules.dir" value="../app/protected/modules" />

    <property file="build.properties" />

    <target name="development">

    </target>

    <target name="config">
        <copy file="../app/protected/config/main.template.php" tofile="app/protected/config/main.php" />
    </target>

    <target name="purgeModels">
        <delete dir="${modules.dir}/core/models" />
        <delete dir="${modules.dir}/account/models" />
        <delete dir="${modules.dir}/bookmarks/models" />
        <delete dir="${modules.dir}/bookmarks/modules/social/models" />
        <delete dir="${modules.dir}/social/models" />
    </target>

    <target name="propel">
        <copy file="runtime-conf.template.xml" tofile="runtime-conf.xml">
            <filterchain>
                <expandproperties />
            </filterchain>
        </copy>

        <copy file="schema.template.xml" tofile="schema.xml">
            <filterchain>
                <expandproperties />
            </filterchain>
        </copy>

        <if>
            <equals arg1="${host.os}" arg2="WINNT" />
            <then>
                <property name="phing.genDir" value="..\vendor\propel\generator\bin\" />
            </then>
            <else>
                <property name="phing.genDir" value="../vendor/propel/generator/bin/" />
            </else>
        </if>

        <exec command="${phing.genDir}propel-gen convert-conf" passthru="true" />
        <exec command="${phing.genDir}propel-gen om" passthru="true" />
        <exec command="${phing.genDir}propel-gen sql" passthru="true" />
        <exec command="${phing.genDir}propel-gen insert-sql" passthru="true" />

        <delete file="schema.xml" />
        <delete file="runtime-conf.xml" />
    </target>

</project>